<style>
  body .layim-chat-main {
    height: auto;
  }
</style>

<body>

  <div class="layim-chat-main">
    <ul id="LAY_view"></ul>
  </div>

  <div id="LAY_page" style="margin: 0 10px;"></div>


  <textarea title="消息模版" id="LAY_tpl" style="display:none;">
    {{# layui.each(d.data, function(index, item){
      if(item.id == parent.layui.layim.cache().mine.id){ }}
        <li class="layim-chat-mine"><div class="layim-chat-user"><img src="{{ item.avatar }}"><cite><i>{{ layui.data.date(item.timestamp) }}</i>{{ item.username }}</cite></div><div class="layim-chat-text">{{ layui.layim.content(item.content) }}</div></li>
      {{# } else { }}
        <li><div class="layim-chat-user"><img src="{{ item.avatar }}"><cite>{{ item.username }}<i>{{ layui.data.date(item.timestamp) }}</i></cite></div><div class="layim-chat-text">{{ layui.layim.content(item.content) }}</div></li>
      {{# }
    }); }}
    </textarea>
  <script>
    layui.use(['laypage', 'layim'], function () {
      var layim = layui.layim
        , layer = layui.layer
        , laytpl = layui.laytpl
        , laypage = layui.laypage;

      var page = 1
      var limit = 20
      var total = 0
      loadData()
      function getPage(cpage) {
        pages = Math.ceil(total / limit) > 0 ? Math.ceil(total / limit) : 1
        laypage({
          cont: 'LAY_page'
          , curr: cpage
          , pages: pages
          , groups: 5 //连续显示分页数
          , jump: function (obj, first) {
            page = obj.curr
            if (!first) {
              loadData()
            }
          }
        });
      }
      function loadData() {
        var param = location.search + '&token=' + token + '&page=' + page + "&limit=" + limit
        console.log(param)
        $.get("/api/record/getData" + param, {}, function (res) {
          total = res.data.count
          var html = laytpl(LAY_tpl.value).render({
            data: res.data.list
          });
          $('#LAY_view').html(html);
          getPage(page)
        }, 'JSON')
      }
    })

  </script>
</body>

</html>