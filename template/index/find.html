<style type="text/css">
    .gray {
        -webkit-filter: grayscale(100%);
        -moz-filter: grayscale(100%);
        -ms-filter: grayscale(100%);
        -o-filter: grayscale(100%);

        filter: grayscale(100%);

        filter: gray;
    }

    .layui-find-list li img {
        position: absolute;
        left: 15px;
        top: 8px;
        width: 36px;
        height: 36px;
        border-radius: 100%;
    }

    .layui-find-list li {
        position: relative;
        height: 90px;
        ;
        padding: 5px 15px 5px 60px;
        font-size: 0;
        cursor: pointer;
    }

    .layui-find-list li * {
        display: inline-block;
        vertical-align: top;
        font-size: 14px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .layui-find-list li span {
        margin-top: 4px;
        max-width: 155px;
    }

    .layui-find-list li p {
        display: block;
        line-height: 18px;
        font-size: 12px;
        color: #999;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .back {
        cursor: pointer;
    }

    /* .lay_page {
        position: fixed;
        bottom: 0;
        margin-left: -15px;
        margin-bottom: 20px;
        background: #fff;
        width: 100%;
    }

    .layui-laypage {
        width: 105px;
        margin: 0 auto;
        display: block
    } */
</style>
<script>
    layui.use(['layim', 'laypage', 'form'], function () {
        var page = 1
        var limit = 8
        var total = 0
        var layim = layui.layim
            , layer = layui.layer
            , laytpl = layui.laytpl
            , form = layui.form
            , $ = layui.jquery
            , laypage = layui.laypage;
        // var url = '../../../../../../'+cache.base.getRecommend.url || {};  //获得URL参数。

        $(function () {
            searchData("friend", "", "推荐好友")
        });
        $('body').on('click', '.add', function () {//添加好友
            var othis = $(this), type = othis.data('type');
            //弹出添加好友框
            // parent.layui.im.addFriendGroup(othis,type);
        });
        //下一篇分享创建群的html
        // $('body').on('click', '.createGroup', function () {//创建群
        //     var othis = $(this);
        //     parent.layui.im.createGroup(othis);
        // });
        $('body').on('click', '.back', function () {//返回推荐好友
            searchData("friend", "", "推荐好友")
            $("#LAY_page").css("display", "none");
        });

        $("body").keydown(function (event) {
            if (event.keyCode == 13) {
                $(".find").click();
            }
        });
        $('body').on('click', '.find', function () {
            $("#LAY_page").css("display", "block");
            var othis = $(this), input = othis.parents('.layui-col-space3').find('input').val();
            var addType = $('input:radio:checked').val();
            page = 1
            searchData("friend", input, "查找结果")
        });
        function getPage(cpage, type = "friend", wd, legend) {
            pages = Math.ceil(total / limit) > 0 ? Math.ceil(total / limit) : 1
            laypage({
                cont: 'LAY_page'
                , curr: cpage
                , pages: pages
                , groups: 10 //连续显示分页数
                , jump: function (obj, first) {
                    page = obj.curr
                    if (!first) {
                        searchData(type, wd, legend)
                    }
                }
            });
        }
        function searchData(type = "friend", wd, legend) {
            var url = "/api/user/search";
            if (type == "group") {
                url = "/api/group/search";
            }
            var param = '?token=' + token + '&page=' + page + "&limit=" + limit + "&wd=" + wd
            $.get(url + param, {}, function (res) {
                total = res.data.count
                var html = laytpl(LAY_tpl.value).render({
                    data: res.data.list,
                    type: type,
                    legend: legend
                });
                $('#LAY_view').html(html);
                getPage(page, type, wd, legend)
            }, 'JSON')
        }
    });
</script>
</head>

<body>
    <div class="layui-form">
        <div class="layui-container" style="padding:0">
            <div class="layui-row layui-col-space3">
                <div class="layui-col-xs7 mt15">
                    <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入关键字"
                        class="layui-input">
                </div>
                <div class="layui-col-xs1 mt15">
                    <button class="layui-btn btncolor find">查找</button>
                </div>

                <div class="layui-col-xs3 mt15">
                    <input type="radio" name="add" value="friend" title="找人" checked="">
                    <input type="radio" name="add" value="group" title="找群">
                    <!-- <button class="layui-btn layui-btn-mini btncolor createGroup">我要建群</button> -->
                </div>
            </div>
            <div id="LAY_view"></div>
            <textarea title="消息模版" id="LAY_tpl" style="display:none;">
			<fieldset class="layui-elem-field layui-field-title">
			  <legend>{{ d.legend}}</legend>
			</fieldset>	
			<div class="layui-row ">
				{{# if(d.type == 'friend'){ }}
					{{#  layui.each(d.data, function(index, item){ }}
					<div class="layui-col-xs3 layui-find-list">
						<li layim-event="add" data-type="friend" data-index="0" data-uid="{{ item.id }}" data-name="{{item.usernamme}}">
                            {{# if (item.status == "online"){ }}
                            <img  src="{{item.avatar}}">
                            {{# }else{ }}
                            <img class="gray" src="{{item.avatar}}">
                            {{# } }}
							<span>{{item.username}}</span>
							<p>{{item.sign}}  {{#  if(item.sign == ''){ }}我很懒，懒得写签名{{#  } }} </p>
							<button class="layui-btn layui-btn-mini btncolor add" data-type="friend"><i class="layui-icon">&#xe654;</i>加好友</button>
						</li>
					</div>
					{{#  }); }}
				{{# }else{ }}
					{{#  layui.each(d.data, function(index, item){ }}
					<div class="layui-col-xs3 layui-find-list">
						<li layim-event="add" data-type="group" data-approval="{{ item.approval }}" data-index="0" data-uid="{{ item.groupIdx }}" data-name="{{item.groupName}}">
							<img src="{{item.avatar}}">
							<span>{{item.nickname}}({{item.groupIdx}})</span>
							<p>{{item.des}}  {{#  if(item.des == ''){ }}无{{#  } }} </p>
							<button class="layui-btn layui-btn-mini btncolor add" data-type="group"><i class="layui-icon">&#xe654;</i>加群</button>
						</li>
					</div>
					{{#  }); }}
				{{# } }}
			</div>	
        </textarea>
            <div style="text-align:center">
                <div class="lay_page" id="LAY_page"></div>
            </div>
        </div>
    </div>
</body>

</html>